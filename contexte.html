<!doctype html>
<html lang="fr">
<head>
 Â <meta charset="utf-8">
 Â <meta name="viewport" content="width=device-width,initial-scale=1">
 Â <title>Contexte environnemental - Plantouille express</title>
 Â <link rel="manifest" href="manifest.json">
 Â <link rel="icon" href="icons/icon-192.png">
 Â <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
 Â <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
 Â <script defer src="ui.js"></script>
 Â <script defer src="contexte.js"></script>
 Â <script defer src="sw-register.js"></script>
 Â <style>
 Â  Â :root{ --primary:#388e3c; --bg:#f6f9fb; --card:#ffffff; --border:#e0e0e0; --text:#202124; }
 Â  Â html[data-theme="dark"]{ --bg:#181a1b; --card:#262b2f; --border:#333; --text:#ececec; }
 Â  Â *{box-sizing:border-box;}
 Â  Â body{ background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; margin:0; padding:0; display:flex; flex-direction:column; min-height:100vh; }
 Â  Â 
 Â  Â /* Navigation par onglets */
 Â  Â .tabs-container { background: var(--card); box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; display:flex; align-items:center; justify-content:space-between; }
 Â  Â .tabs { display: flex; border-bottom: 2px solid var(--border); flex-grow:1; }
 Â  Â .tab { flex: 1; padding: 1rem; text-align: center; cursor: pointer; background: none; border: none; font-size: 1rem; color: var(--text); transition: all 0.3s; position: relative; }
 Â  Â .tab:hover { background: rgba(56, 142, 60, 0.1); }
 Â  Â .tab.active { color: var(--primary); font-weight: 600; }
 Â  Â .tab.active::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: var(--primary); }
 Â  Â 
 Â  Â /* Contenu principal */
 Â  Â .main-content { flex: 1; padding: 1.5rem; max-width: 900px; margin: 0 auto; width: 100%; }
 Â  Â h1 { color: var(--primary); margin: 0 0 1.5rem; font-size: 1.6rem; text-align: center; }
 Â  Â 
 Â  Â /* Options de localisation */
 Â  Â .location-options { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2rem; }
 Â  Â .location-card { background: var(--card); border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
 Â  Â .location-card h2 { font-size: 1.2rem; color: var(--primary); margin: 0 0 1rem; }
 Â  Â 
 Â  Â .action-button { padding: 12px 20px; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: all 0.3s; width: 100%; }
 Â  Â .action-button:hover { background: #2e7d32; transform: scale(1.02); }
 Â  Â .action-button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
 Â  Â 
 Â  Â /* Carte interactive */
 Â  Â #map-container { display: none; margin-top: 1rem; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
 Â  Â #map { height: 400px; width: 100%; }
 Â  Â 
 Â  Â /* CoordonnÃ©es sÃ©lectionnÃ©es */
 Â  Â .coordinates-display { display: none; margin-top: 1rem; padding: 1rem; background: rgba(56, 142, 60, 0.1); border-radius: 6px; text-align: center; }
 Â  Â .coordinates-display span { font-weight: 600; color: var(--primary); }
 Â  Â 
 Â  Â /* RÃ©sultats */
 Â  Â .results-section { display: none; margin-top: 2rem; }
 Â  Â .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-top: 1rem; }
 Â  Â .result-card { background: var(--card); border-radius: 8px; padding: 1rem; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
 Â  Â .result-card h3 { color: var(--primary); margin: 0 0 0.5rem; font-size: 1.1rem; }
 Â  Â .result-card a { display: inline-block; margin-top: 0.5rem; color: var(--primary); text-decoration: none; }
 Â  Â .result-card a:hover { text-decoration: underline; }
 Â  Â 
 Â  Â /* Chargement */
 Â  Â .loading { display: none; text-align: center; margin: 2rem 0; }
 Â  Â .loading::after { content: ''; display: inline-block; width: 30px; height: 30px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
 Â  Â @keyframes spin { to { transform: rotate(360deg); } }
 Â  Â 
 Â  Â /* Message d'instruction sur la carte */
 Â  Â .map-instruction { display: none; position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.7); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; z-index: 1000; pointer-events: none; }
 Â  Â 
 Â  Â @media (prefers-color-scheme:dark) {
 Â  Â  Â :root{--bg:#181a1b;--card:#262b2f;--border:#333;--text:#ececec}
 Â  Â  Â .coordinates-display { background: rgba(56, 142, 60, 0.2); }
 Â  Â  Â .map-instruction { background: rgba(255, 255, 255, 0.15); }
 Â  Â }
 Â  Â #theme-toggle{background:none;border:none;cursor:pointer;font-size:1.2rem;color:var(--text);padding:0 1rem;}
 Â  Â #theme-toggle:hover{transform:scale(1.1);}

    /* NOUVEAU : Styles pour les popups Leaflet */
    .leaflet-popup-content-wrapper { border-radius: 8px; }
    .leaflet-popup-content { font-size: 14px; max-height: 250px; overflow-y: auto; }
    .leaflet-popup-content h4 { margin: 0 0 10px 0; padding-bottom: 5px; border-bottom: 1px solid var(--border); color: var(--primary); font-size: 16px; }
    .leaflet-popup-content h5 { margin: 15px 0 5px 0; font-size: 14px; color: var(--text); font-weight: bold; border-bottom: 1px solid #eee; padding-bottom: 4px; }
    .popup-item { margin-bottom: 12px; }
    .popup-item .site-name { font-weight: bold; margin: 0 0 5px 0; color: var(--text); }
    .popup-item .site-link { color: var(--primary); }
    .popup-item .no-link { font-style: italic; color: #888; }
 Â </style>
</head>
<body>
 Â Â <nav class="tabs-container">
 Â  Â <div class="tabs">
 Â  Â  Â <button class="tab" onclick="window.location.href='index.html'">Identification</button>
 Â  Â  Â <button class="tab active">Contexte environnemental</button>
 Â  Â  Â <button class="tab" onclick="window.location.href='sheets.html'">Google Sheets</button>
 Â  Â  Â <button class="tab" onclick="window.location.href='pca.html'">PCA Habitat</button>
 Â  Â </div>
 Â  Â <button id="theme-toggle" title="Basculer le thÃ¨me">ğŸŒ™</button>
 Â </nav>
 Â 
 Â <div class="main-content">
 Â  Â <h1>Contexte environnemental</h1>
 Â  Â 
 Â  Â <div class="location-options">
 Â  Â  Â Â  Â  Â <div class="location-card">
 Â  Â  Â  Â <h2>ğŸ“ Utiliser ma position actuelle</h2>
 Â  Â  Â  Â <button class="action-button" id="use-geolocation">
 Â  Â  Â  Â  Â Utiliser ma localisation
 Â  Â  Â  Â </button>
 Â  Â  Â </div>
 Â  Â  Â 
 Â  Â  Â Â  Â  Â <div class="location-card">
 Â  Â  Â  Â <h2>ğŸ—ºï¸ Choisir un endroit sur la carte</h2>
 Â  Â  Â  Â <button class="action-button" id="choose-on-map">
 Â  Â  Â  Â  Â Ouvrir la carte
 Â  Â  Â  Â </button>
 Â  Â  Â  Â 
 Â  Â  Â  Â <div id="map-container">
 Â  Â  Â  Â  Â <div class="map-instruction" id="map-instruction">
 Â  Â  Â  Â  Â  Â Cliquez longuement pour sÃ©lectionner un point
 Â  Â  Â  Â  Â </div>
 Â  Â  Â  Â  Â <div id="map"></div>
 Â  Â  Â  Â </div>
 Â  Â  Â  Â 
 Â  Â  Â  <div class="coordinates-display" id="coordinates-display">
 Â  Â  Â  Â CoordonnÃ©es sÃ©lectionnÃ©es :
 Â  Â  Â  Â <span id="selected-coords">--</span>
 Â  Â  Â  </div>

 Â  Â  Â  <button class="action-button" id="validate-location" style="display:none; margin-top:1rem;">
 Â  Â  Â  Â Valider cette localisation
 Â  Â  Â  </button>
 Â  Â  Â </div>

 Â  Â  Â Â  Â  Â <div class="location-card">
 Â  Â  Â  Â <h2>ğŸ” Rechercher une adresse</h2>
 Â  Â  Â  Â <input type="text" id="address-input" placeholder="Saisissez une adresse"
 Â  Â  Â  Â  Â  Â  Â  style="padding:8px;border:1px solid var(--border);border-radius:4px;width:100%;margin-bottom:.5rem;">
 Â  Â  Â  Â <button class="action-button" id="search-address">Rechercher</button>
 Â  Â  Â </div>
 Â  Â </div>
 Â  Â 
 Â  Â Â  Â <div class="loading" id="loading"></div>
 Â  Â 
 Â  Â Â  Â <div class="results-section" id="results-section">
 Â  Â  Â <h2>Ressources environnementales</h2>
 Â  Â  Â <p style="margin-bottom: 1rem; color: #666;">
 Â  Â  Â  Â Cliquez sur les liens ci-dessous pour explorer le contexte de la zone, ou cliquez sur la carte pour obtenir le dÃ©tail des zonages.
 Â  Â  Â </p>
 Â  Â  Â <div class="results-grid" id="results-grid">
 Â  Â  Â  Â Â  Â  Â </div>
 Â  Â  Â Â  Â  Â <h2 style="margin-top:2rem;">Carte interactive</h2>
 Â  Â  Â <div id="layer-controls" style="margin-bottom:0.5rem;"></div>
 Â  Â  Â <div id="env-map" style="height:400px;width:100%;display:none; border-radius: 8px;"></div>
 Â  Â </div>
 Â </div>
</body>
</html>
